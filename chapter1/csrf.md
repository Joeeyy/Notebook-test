## 简介

CSRF，即Cross Site Request Forgery，跨站请求伪造攻击。攻击者通过一些技术手段欺骗用户浏览器访问曾经认证过的一些网站并执行一些操作（发帖等等）。由于浏览器在这些网站上有认证信息，故而被访问的网站可能会认为这些是真正的用户发出的请求而执行。这是利用了Web中用户身份验证的一个漏洞：**简单的身份验证只能保证请求来自某个用户的浏览器，而不能保证请求本身是用户自愿发出的**。

## 举例

假如某银行用以运行转账操作的URL如下：

```
http://www.examplebank.com/withdraw?account=AccountName&amount=1000&for=PayeeName
```

那么，攻击者可以在另一个网站的页面上留下如下代码：

```
<img src="http://www.examplebank.com/withdraw?account=Alice&amount=1000&for=Badman">
```

如果账户认证为Alice的用户访问了该页面，且该用户刚刚访问了银行网站不久，登录信息还没有过期，那么她就会损失1000资金。

## 攻击方式

攻击连接可以防止在任何网站（正规博客、论坛等等），等待用户的点击。**如果服务端没有合适地防御措施，即使用户访问的都是可信站点也有可能受到攻击**。

## 攻击点

攻击者不能够通过CSRF攻击直接获取用户账户的控制权，也无法窃取用户的任何信息，他们所能做到的是**欺骗用户浏览器，让其以用户的名义进行操作**。

## 防御措施

1.  检查Referer字段

HTTP头部中的Referer字段用以标明请求来自于哪一个地址。敏感操作的请求一般都会来自于同域名下，而恶意构造的攻击请求无法保证这一点。

这种防御措施简单易实现，仅需要在关键访问的地方添加一个校验。但是无法保证浏览器的可靠性，也存在攻击者攻击浏览器，篡改其Referer字段的可能。

也有可能攻击者会制造空Referer的请求。



1. 添加校验token

> 参考:
>
> 1. [Wikipedia: 跨站请求伪造](https://zh.wikipedia.org/wiki/跨站请求伪造)
> 2. 《白帽子讲Web安全》



